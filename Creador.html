<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Creador de Código — Tatuajes</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0B0F14; --surface:#11161D; --text:#F6F8FA; --text-dim:#7E8793;
  --muted:#BFC6CF; --line:#FFFFFF1F; --accent:#3F6076; --accent-deep:#0E2A3A; --glow:#E7F1FF;
  --r:18px; --shadow:0 20px 60px rgba(0,0,0,.45);
}
*{box-sizing:border-box}
body{
  margin:0; color:var(--text); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background: radial-gradient(1200px 800px at 70% 10%, #11161D 0%, var(--bg) 55%);
}
.wrapper{max-width:1100px;margin:40px auto;padding:24px}
h1{font-family:"Space Grotesk",Inter,sans-serif;font-weight:700;letter-spacing:.3px;margin:0 0 8px}
.sub{color:var(--text-dim);margin:0 0 24px}
.panel{
  background: color-mix(in oklab, #11161D 85%, white 15%);
  border:1px solid var(--line); border-radius: var(--r); box-shadow:var(--shadow);
  backdrop-filter: blur(14px); padding:22px; margin-bottom:18px;
}
.grid{display:grid; gap:16px}
@media(min-width:990px){ .grid{grid-template-columns:1.1fr 1fr} }

label{display:block; font-size:.92rem; color:var(--muted); margin-bottom:8px}
input[type="text"],input[type="number"],select,textarea{
  width:100%; padding:12px 14px; border-radius:12px; background:#0E1218; color:var(--text);
  border:1px solid var(--line); outline:none
}
.row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
.row3{display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px}
.small{font-size:.85rem;color:var(--text-dim);margin-top:6px}

.table{width:100%; border-collapse:collapse; margin-top:10px}
.table th,.table td{padding:10px;border-bottom:1px solid var(--line); text-align:left; color:var(--muted)}
.table th{color:var(--text); font-weight:600}

.btn{padding:12px 16px;border:1px solid var(--line);border-radius:999px;background:transparent;color:var(--text);cursor:pointer;transition:.25s}
.btn:hover{border-color:#dfe9ff55;box-shadow:0 0 0 6px #dfe9ff22,0 8px 28px rgba(0,0,0,.4)}
.btn-primary{background:#3F6076; border:none}
.btn-green{background:#25D366; color:#0b0f14; border:none; font-weight:700}
.btn-danger{border-color:#ff6b6b88; color:#ff9f9f}
.actions{display:flex; gap:10px; flex-wrap:wrap}

textarea#output{width:100%; min-height:320px; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-size:.88rem}

@media (max-width:640px){
  .row,.row3{grid-template-columns:1fr}
  .actions{flex-direction:column}
}
</style>
</head>
<body>
<div class="wrapper">
  <h1>Creador de Código — Tatuajes</h1>
  <p class="sub">Configura precios, estilos y WhatsApp. Luego genera un HTML listo para publicar (con el estilo “glass & chrome”).</p>

  <!-- CONFIGURACIÓN -->
  <div class="grid">
    <div class="panel">
      <h2 style="margin:0 0 14px;font-family:'Space Grotesk'">Parámetros generales</h2>
      <div class="row">
        <div>
          <label>Título (H1) del sitio</label>
          <input id="cfgTitle" type="text" value="Presupuesto de Arte en Piel">
        </div>
        <div>
          <label>Número de WhatsApp (con país, sin símbolos)</label>
          <input id="cfgPhone" type="text" value="573124863086" placeholder="57XXXXXXXXXX">
        </div>
      </div>

      <div class="row">
        <div>
          <label>Moneda — símbolo</label>
          <input id="cfgCurrencySymbol" type="text" value="$">
        </div>
        <div>
          <label>Moneda — código (ej.: USD, COP)</label>
          <input id="cfgCurrencyCode" type="text" value="USD">
        </div>
      </div>

      <div class="row">
        <div>
          <label>Base por cm²</label>
          <input id="cfgBase" type="number" min="0" step="0.01" value="2.5">
          <div class="small">Se multiplica por área × zona × estilo.</div>
        </div>
        <div>
          <label>Multiplicadores por dificultad de zona</label>
          <div class="row">
            <input id="cfgZoneFacil" type="number" step="0.01" value="1.0" placeholder="Fácil">
            <input id="cfgZoneMedia" type="number" step="0.01" value="1.15" placeholder="Media">
          </div>
          <div class="row" style="margin-top:8px">
            <input id="cfgZoneDificil" type="number" step="0.01" value="1.3" placeholder="Difícil">
            <div></div>
          </div>
        </div>
      </div>

      <h3 style="font-family:'Space Grotesk'; margin:18px 0 8px">Mínimos por tamaño</h3>
      <div class="row3">
        <div>
          <label>Micro ≤ (cm²)</label>
          <input id="cfgT1Area" type="number" min="1" value="15">
          <div class="row" style="margin-top:8px">
            <div>
              <label>Precio mín. Micro</label>
              <input id="cfgT1Price" type="number" min="0" step="1" value="25">
            </div>
          </div>
        </div>
        <div>
          <label>Pequeña ≤ (cm²)</label>
          <input id="cfgT2Area" type="number" min="1" value="60">
          <div class="row" style="margin-top:8px">
            <div>
              <label>Precio mín. Pequeña</label>
              <input id="cfgT2Price" type="number" min="0" step="1" value="85">
            </div>
          </div>
        </div>
        <div>
          <label>Mediana ≤ (cm²)</label>
          <input id="cfgT3Area" type="number" min="1" value="200">
          <div class="row" style="margin-top:8px">
            <div>
              <label>Precio mín. Mediana</label>
              <input id="cfgT3Price" type="number" min="0" step="1" value="145">
            </div>
          </div>
        </div>
      </div>
      <div class="row" style="margin-top:8px">
        <div>
          <label>Precio mín. Grande (˃ Mediana)</label>
          <input id="cfgT4Price" type="number" min="0" step="1" value="215">
        </div>
        <div></div>
      </div>
    </div>

    <!-- ESTILOS -->
    <div class="panel">
      <h2 style="margin:0 0 14px;font-family:'Space Grotesk'">Estilos de tatuaje</h2>
      <table class="table" id="stylesTable">
        <thead>
          <tr><th>Estilo</th><th>Multiplicador</th><th></th></tr>
        </thead>
        <tbody id="stylesBody"></tbody>
      </table>
      <div class="actions" style="margin-top:10px">
        <button class="btn" id="addStyle">Añadir estilo</button>
        <span class="small">Ejemplos: Blackwork 0.7 · Realismo 1.3 · A color 1.3</span>
      </div>
    </div>
  </div>

  <!-- GENERAR -->
  <div class="panel">
    <h2 style="margin:0 0 10px;font-family:'Space Grotesk'">Generar código</h2>
    <div class="actions" style="margin:8px 0 12px">
      <button class="btn btn-primary" id="btnGenerate">Generar HTML</button>
      <button class="btn" id="btnCopy">Copiar</button>
      <button class="btn btn-green" id="btnDownload">Descargar .html</button>
    </div>
    <textarea id="output" placeholder="Aquí aparecerá el código generado..."></textarea>
    <p class="small">* WhatsApp no permite adjuntar automáticamente imágenes desde el navegador. El HTML generado incluye el nombre del archivo y una nota para enviarla manualmente al abrir el chat.</p>
  </div>
</div>

<script>
/* -------- Defaults de estilos -------- */
const defaultStyles = [
  { name:"Blackwork", factor:0.7 },
  { name:"Realismo", factor:1.3 },
  { name:"Microrrealismo", factor:1.2 },
  { name:"Minimalismo", factor:0.7 },
  { name:"A color", factor:1.3 },
  { name:"Estilo ilustrativo", factor:0.9 },
  { name:"Tribal", factor:1.0 },
  { name:"Tribal gótico", factor:1.1 },
];

const stylesBody = document.getElementById('stylesBody');
function addStyleRow(name="", factor=1){
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input type="text" value="${name}" placeholder="Nombre del estilo"></td>
    <td><input type="number" step="0.01" value="${factor}"></td>
    <td><button class="btn btn-danger" type="button">Eliminar</button></td>
  `;
  tr.querySelector('button').addEventListener('click', ()=> tr.remove());
  stylesBody.appendChild(tr);
}

defaultStyles.forEach(s=>addStyleRow(s.name, s.factor));
document.getElementById('addStyle').addEventListener('click', ()=> addStyleRow("",1));

/* -------- Helpers -------- */
function getStyles(){
  const rows = [...stylesBody.querySelectorAll('tr')];
  const list = [];
  for(const r of rows){
    const name = r.querySelector('input[type="text"]').value.trim();
    const factor = parseFloat(r.querySelector('input[type="number"]').value);
    if(!name) continue;
    list.push({name, factor: isFinite(factor)? factor:1});
  }
  return list;
}

function buildOptionsHTML(styles){
  return styles.map(s=>`<option>${escapeHtml(s.name)}</option>`).join('\n            ');
}

function buildStyleObject(styles){
  // {"Blackwork":0.7, "Realismo":1.3, ...}
  const pairs = styles.map(s=>`"${s.name.replaceAll('"','\\"')}":${s.factor}`);
  return `{ ${pairs.join(', ')} }`;
}

function escapeHtml(str){
  return str.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

/* -------- Plantilla del HTML final -------- */
function generateFinalHTML(cfg){
  const optionsHTML = buildOptionsHTML(cfg.styles);
  const styleObj = buildStyleObject(cfg.styles);

  return `<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>${escapeHtml(cfg.title)}</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0B0F14; --surface:#11161D; --text:#F6F8FA; --text-dim:#7E8793;
  --muted:#BFC6CF; --line:#FFFFFF1F; --accent:#3F6076; --accent-deep:#0E2A3A; --glow:#E7F1FF;
  --r:18px; --shadow:0 20px 60px rgba(0,0,0,.45);
}
*{box-sizing:border-box}
body{
  margin:0; color:var(--text); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background: radial-gradient(1200px 800px at 70% 10%, #11161D 0%, var(--bg) 55%);
}
.wrapper{max-width:1080px;margin:40px auto;padding:24px}
h1{font-family:"Space Grotesk",Inter,sans-serif;font-weight:700;letter-spacing:.3px;margin:0 0 12px}
.sub{color:var(--text-dim);margin-bottom:28px}
.panel{
  background: color-mix(in oklab, #11161D 85%, white 15%);
  border:1px solid var(--line); border-radius: var(--r); box-shadow:var(--shadow);
  backdrop-filter: blur(14px); padding:22px; margin-bottom:18px;
}
.grid{display:grid; gap:16px}
@media(min-width:900px){ .grid{grid-template-columns:1.2fr 1fr} }

label{display:block; font-size:.92rem; color:var(--muted); margin-bottom:8px}
select,input{width:100%; padding:12px 14px; border-radius:12px; background:#0E1218; color:var(--text);
  border:1px solid var(--line); outline:none}
input[type="number"]{appearance:textfield}
.row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
.help{font-size:.85rem;color:var(--text-dim);margin-top:6px}

.btn{padding:12px 16px;border:1px solid var(--line);border-radius:999px;background:transparent;color:var(--text);cursor:pointer;transition:.25s}
.btn:hover{border-color:#dfe9ff55;box-shadow:0 0 0 6px #dfe9ff22,0 8px 28px rgba(0,0,0,.4)}
.file{display:flex;align-items:center;gap:12px}
.file input{padding:10px;background:#0E1218}

.summary h2{margin:0 0 10px;font-family:"Space Grotesk";letter-spacing:.3px}
.price{
  font-family:"Space Grotesk",Inter,sans-serif; font-size:46px; font-weight:700;
  background: linear-gradient(180deg,#E7F1FF,#BFC6CF); -webkit-background-clip:text; color:transparent
}
.table{width:100%; border-collapse:collapse; margin-top:10px}
.table td{padding:8px 0; border-bottom:1px solid var(--line); color:var(--muted)}
.table td:first-child{color:var(--text);}

.badge{font:600 .78rem/1 "Space Grotesk"; color:#BFC6CF; background:#0E1218; border:1px solid var(--line); padding:6px 10px; border-radius:999px}
.footer{display:flex;gap:12px;flex-wrap:wrap;margin-top:16px;align-items:center}
.note{color:var(--text-dim);font-size:.86rem}

/* Botón WhatsApp */
.btn-whatsapp{
  background:#25D366; color:#0b0f14; border:none; font-weight:700;
}
.btn-whatsapp:hover{box-shadow:0 0 0 6px #25d36633,0 8px 28px rgba(0,0,0,.4)}

/* Responsivo extra */
@media (max-width: 600px){
  .wrapper{padding:16px; margin:24px auto}
  h1{font-size:1.6rem}
  .sub{font-size:.95rem}
  .panel{padding:16px}
  .row{grid-template-columns:1fr; gap:10px}
  .price{font-size:36px}
  .footer{flex-direction:column; align-items:stretch; gap:10px}
  .btn, .btn-whatsapp{width:100%}
}
input, select { font-size:16px; } /* evitar zoom iOS */
#filename{ max-width: 100%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
</style>
</head>
<body>
<div class="wrapper">
  <h1>${escapeHtml(cfg.title)}</h1>
  <div class="sub">Selecciona zona, estilo y tamaño. El precio se actualiza en tiempo real.</div>

  <div class="grid">
    <!-- FORM -->
    <div class="panel">
      <div class="row">
        <div>
          <label>Hemilado del cuerpo</label>
          <select id="side">
            <option value="derecho">Derecho</option>
            <option value="izquierdo">Izquierdo</option>
            <option value="central">Central</option>
          </select>
        </div>
        <div>
          <label>Región</label>
          <select id="region">
            <option value="cabeza_cuello">Cabeza / Cuello</option>
            <option value="brazo">Brazo</option>
            <option value="torso">Torso</option>
            <option value="pierna">Pierna</option>
            <option value="otros">Otros</option>
          </select>
        </div>
      </div>

      <div>
        <label>Parte específica</label>
        <select id="part"></select>
        <div class="help">Ej.: Antebrazo interno, costillas externas, gemelo, etc.</div>
      </div>

      <div class="row">
        <div>
          <label>Estilo</label>
          <select id="style">
            ${optionsHTML}
          </select>
        </div>
        <div>
          <label>Dimensiones (cm)</label>
          <div class="row">
            <input id="w" type="number" min="1" placeholder="Ancho">
            <input id="h" type="number" min="1" placeholder="Alto">
          </div>
        </div>
      </div>

      <div>
        <label>Subir referencia (imagen)</label>
        <div class="file">
          <input id="file" type="file" accept="image/*">
          <span class="badge" id="filename">Sin archivo</span>
        </div>
        <div class="help">PNG/JPG. Máx. 10 MB.</div>
      </div>
    </div>

    <!-- SUMMARY -->
    <div class="panel summary">
      <h2>Estimado</h2>
      <div class="price" id="price">${cfg.currencySymbol}0</div>
      <table class="table">
        <tr><td>Área</td><td id="area">0 cm²</td></tr>
        <tr><td>Zona (multiplicador)</td><td id="zoneMult">–</td></tr>
        <tr><td>Estilo (multiplicador)</td><td id="styleMult">–</td></tr>
        <tr><td>Base por cm²</td><td id="base">${cfg.currencySymbol}${Number(cfg.base).toFixed(2)}</td></tr>
        <tr><td>Mínimo aplicado</td><td id="min">${cfg.currencySymbol}0</td></tr>
      </table>
      <div class="footer">
        <button class="btn" id="reset">Reiniciar</button>
        <button class="btn btn-whatsapp" id="sendWA">Enviar por WhatsApp</button>
        <span class="note">* WhatsApp no permite adjuntar automáticamente archivos desde la web. Envía la imagen al abrir el chat.</span>
      </div>
    </div>
  </div>
</div>

<script>
/* ----- Config de negocio generada ----- */
const CURRENCY_SYMBOL = ${JSON.stringify(cfg.currencySymbol)};
const CURRENCY_CODE = ${JSON.stringify(cfg.currencyCode)};
const PHONE_NUMBER = ${JSON.stringify(cfg.phone)};

const BASE_PER_CM2 = ${Number(cfg.base)};
const STYLE_MULT = ${styleObj};
const ZONE_MULT = { facil:${Number(cfg.zoneFacil)}, media:${Number(cfg.zoneMedia)}, dificil:${Number(cfg.zoneDificil)} };

const THRESHOLDS = {
  t1Area:${Number(cfg.t1Area)}, t1Price:${Number(cfg.t1Price)},
  t2Area:${Number(cfg.t2Area)}, t2Price:${Number(cfg.t2Price)},
  t3Area:${Number(cfg.t3Area)}, t3Price:${Number(cfg.t3Price)},
  t4Price:${Number(cfg.t4Price)}
};

const PARTS = {
  cabeza_cuello: {
    mult:"dificil",
    items:["Cara - mejilla","Cara - sien","Oreja externa","Oreja interna","Nuca","Garganta"]
  },
  brazo: {
    mult:"media",
    items:["Hombro externo","Bíceps","Tríceps","Antebrazo externo","Antebrazo interno","Codo","Muñeca","Mano - dorso","Mano - palma","Dedos"]
  },
  torso: {
    mult:"media",
    items:["Pecho derecho","Pecho izquierdo","Esternón","Abdomen alto","Abdomen bajo","Costillas externas","Costillas internas","Ombligo / perímetro","Espalda alta","Espalda media","Espalda baja"]
  },
  pierna: {
    mult:"facil",
    items:["Muslo frontal","Muslo posterior","Rodilla","Gemelo / pantorrilla","Tibia (frontal)","Tobillo","Pie - empeine","Pie - planta","Dedos del pie"]
  },
  otros: {
    mult:"dificil",
    items:["Axila","Clavícula","Cadera / lateral","Glúteo","Cuello lateral"]
  }
};

// Mínimos por tamaño
function sizeMinimum(area){
  if(area<=THRESHOLDS.t1Area) return THRESHOLDS.t1Price;
  if(area<=THRESHOLDS.t2Area) return THRESHOLDS.t2Price;
  if(area<=THRESHOLDS.t3Area) return THRESHOLDS.t3Price;
  return THRESHOLDS.t4Price;
}

/* ----- UI ----- */
const region = document.getElementById('region');
const part = document.getElementById('part');
const style = document.getElementById('style');
const w = document.getElementById('w');
const h = document.getElementById('h');
const file = document.getElementById('file');
const side = document.getElementById('side');

let lastArea = 0;
let lastPrice = 0;

function populateParts(){
  const conf = PARTS[region.value];
  part.innerHTML = "";
  conf.items.forEach(i=>{
    const opt = document.createElement('option');
    opt.textContent = i; opt.value = i;
    part.appendChild(opt);
  });
  calc();
}

region.addEventListener('change', populateParts);
[w,h,style,part,side].forEach(el=>el.addEventListener('input', calc));
file.addEventListener('change', ()=> {
  document.getElementById('filename').textContent = file.files[0]?.name || "Sin archivo";
});

document.getElementById('reset').addEventListener('click', ()=>{
  w.value = ""; h.value=""; style.selectedIndex=0; region.selectedIndex=0; side.selectedIndex=0; populateParts();
  document.getElementById('filename').textContent="Sin archivo";
});

/* --------- Cálculo --------- */
function calc(){
  const width = parseFloat(w.value)||0;
  const height = parseFloat(h.value)||0;
  const area = +(width*height).toFixed(1);
  const zoneM = ZONE_MULT[ PARTS[region.value].mult ];
  const styleM = STYLE_MULT[ style.value ];
  const raw = area * BASE_PER_CM2 * zoneM * styleM;
  const min = sizeMinimum(area);
  const price = Math.max(raw, min);

  // UI
  document.getElementById('area').textContent = \`\${area} cm²\`;
  document.getElementById('zoneMult').textContent = \`\${region.options[region.selectedIndex].text} (\${zoneM}×)\`;
  document.getElementById('styleMult').textContent = \`\${style.value} (\${styleM}×)\`;
  document.getElementById('base').textContent = \`\${CURRENCY_SYMBOL}\${BASE_PER_CM2.toFixed(2)}\`;
  document.getElementById('min').textContent = area? \`\${CURRENCY_SYMBOL}\${min.toFixed(0)}\` : \`\${CURRENCY_SYMBOL}0\`;
  document.getElementById('price').textContent = \`\${isFinite(price)? CURRENCY_SYMBOL+price.toFixed(0):CURRENCY_SYMBOL+'0'}\`;

  lastArea = area;
  lastPrice = isFinite(price)? Math.round(price):0;
}

populateParts(); // init

/* --------- WhatsApp --------- */
function buildMessage(){
  const regionText = region.options[region.selectedIndex].text;
  const msg =
\`Hola 👋 quiero cotizar este tatuaje:

• Lado: \${side.value}
• Región: \${regionText}
• Parte específica: \${part.value}
• Estilo: \${style.value}
• Tamaño: \${w.value||0} cm (ancho) × \${h.value||0} cm (alto)
• Área: \${lastArea} cm²

💵 Estimado: \${CURRENCY_SYMBOL}\${lastPrice} \${CURRENCY_CODE} (orientativo)
📎 Referencia: \${file.files[0]?.name || "sin archivo adjunto"}

¿Me confirmas disponibilidad y proceso? Gracias.\`;
  return encodeURIComponent(msg);
}

document.getElementById('sendWA').addEventListener('click', async ()=>{
  const url = \`https://wa.me/\${PHONE_NUMBER}?text=\${buildMessage()}\`;

  // Intento de compartir con imagen si el navegador lo soporta
  const f = file.files[0];
  if (f && navigator.canShare && navigator.canShare({files:[f]})) {
    try{
      await navigator.share({ files:[f], text: decodeURIComponent(buildMessage()) });
      return;
    }catch(e){
      window.open(url, '_blank'); return;
    }
  }
  // Fallback: abrir chat con el texto (sin imagen)
  window.open(url, '_blank');
});
</script>
</body>
</html>`;
}

/* -------- Acciones -------- */
function readCfg(){
  return {
    title: document.getElementById('cfgTitle').value || 'Presupuesto de Arte en Piel',
    phone: document.getElementById('cfgPhone').value.replace(/\D/g,''),
    currencySymbol: document.getElementById('cfgCurrencySymbol').value || '$',
    currencyCode: document.getElementById('cfgCurrencyCode').value || 'USD',
    base: parseFloat(document.getElementById('cfgBase').value) || 0,

    zoneFacil: parseFloat(document.getElementById('cfgZoneFacil').value) || 1,
    zoneMedia: parseFloat(document.getElementById('cfgZoneMedia').value) || 1.15,
    zoneDificil: parseFloat(document.getElementById('cfgZoneDificil').value) || 1.3,

    t1Area: parseFloat(document.getElementById('cfgT1Area').value) || 15,
    t1Price: parseFloat(document.getElementById('cfgT1Price').value) || 25,
    t2Area: parseFloat(document.getElementById('cfgT2Area').value) || 60,
    t2Price: parseFloat(document.getElementById('cfgT2Price').value) || 85,
    t3Area: parseFloat(document.getElementById('cfgT3Area').value) || 200,
    t3Price: parseFloat(document.getElementById('cfgT3Price').value) || 145,
    t4Price: parseFloat(document.getElementById('cfgT4Price').value) || 215,

    styles: getStyles()
  };
}

document.getElementById('btnGenerate').addEventListener('click', ()=>{
  const cfg = readCfg();
  if(!cfg.phone){ alert('Ingresa un número de WhatsApp válido (con indicativo).'); return; }
  if(!cfg.styles.length){ alert('Agrega al menos un estilo.'); return; }
  const html = generateFinalHTML(cfg);
  document.getElementById('output').value = html;
});

document.getElementById('btnCopy').addEventListener('click', async ()=>{
  const txt = document.getElementById('output').value;
  if(!txt){ alert('Primero genera el HTML.'); return; }
  await navigator.clipboard.writeText(txt);
  alert('Código copiado al portapapeles.');
});

document.getElementById('btnDownload').addEventListener('click', ()=>{
  const txt = document.getElementById('output').value;
  if(!txt){ alert('Primero genera el HTML.'); return; }
  const blob = new Blob([txt], {type:'text/html;charset=utf-8'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'tatuaje_presupuesto.html';
  document.body.appendChild(a);
  a.click();
  URL.revokeObjectURL(a.href);
  a.remove();
});
</script>
</body>
</html>
